# MIME types
<IfModule mod_mime.c>
    AddType font/woff2 .woff2
    AddType image/webp .webp
</IfModule>

# SEO normalization
RewriteEngine On
RewriteBase /

# WWW redirect
RewriteCond %{HTTP_HOST} ^www\.bmarwell\.de$ [NC]
RewriteRule ^(.*)$ https://bmarwell.de/$1 [R=301,L]

# index.html redirect
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /index\.html\ HTTP/
RewriteRule ^index\.html$ https://bmarwell.de/ [R=301,L]

# Pre-compressed file serving for HTML only
# Note: woff2 fonts are already optimally compressed, no pre-compression needed
RewriteCond %{HTTP:Accept-Encoding} zstd [NC]
RewriteCond %{REQUEST_FILENAME}.zst -f
RewriteRule ^(.*)$ $1.zst [L,T=text/html]

RewriteCond %{HTTP:Accept-Encoding} br [NC]
RewriteCond %{REQUEST_FILENAME}.br -f
RewriteRule ^(.*)$ $1.br [L,T=text/html]

RewriteCond %{HTTP:Accept-Encoding} gzip [NC]
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)$ $1.gz [L,T=text/html]

# Set headers for compressed HTML files
<FilesMatch "\.(html|htm)\.(zst|br|gz)$">
    <IfModule mod_headers.c>
        Header set Content-Type "text/html; charset=utf-8"
        Header set Vary "Accept-Encoding"
    </IfModule>
</FilesMatch>

# Content-Encoding headers
<FilesMatch "\.zst$">
    Header set Content-Encoding "zstd"
</FilesMatch>

<FilesMatch "\.br$">
    Header set Content-Encoding "br"
</FilesMatch>

<FilesMatch "\.gz$">
    Header set Content-Encoding "gzip"
</FilesMatch>

# Cache headers
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
</IfModule>
