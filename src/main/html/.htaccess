# SEO normalization
RewriteEngine On
RewriteBase /

# WWW redirect
RewriteCond %{HTTP_HOST} ^www\.bmarwell\.de$ [NC]
RewriteRule ^(.*)$ https://bmarwell.de/$1 [R=301,L]

# index.html redirect
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /index\.html\ HTTP/
RewriteRule ^index\.html$ https://bmarwell.de/ [R=301,L]

# Pre-compressed file serving
RewriteCond %{HTTP:Accept-Encoding} zstd [NC]
RewriteCond %{REQUEST_FILENAME}.zst -f
RewriteRule ^(.*)$ $1.zst [L,T=text/html]

RewriteCond %{HTTP:Accept-Encoding} br [NC]
RewriteCond %{REQUEST_FILENAME}.br -f
RewriteRule ^(.*)$ $1.br [L,T=text/html]

RewriteCond %{HTTP:Accept-Encoding} gzip [NC]
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)$ $1.gz [L,T=text/html]

# Set headers for compressed files
<FilesMatch "\.(zst|br|gz)$">
    <IfModule mod_headers.c>
        Header set Content-Type "text/html; charset=utf-8"
        Header set Vary "Accept-Encoding"
    </IfModule>
</FilesMatch>

<FilesMatch "\.zst$">
    Header set Content-Encoding "zstd"
</FilesMatch>

<FilesMatch "\.br$">
    Header set Content-Encoding "br"
</FilesMatch>

<FilesMatch "\.gz$">
    Header set Content-Encoding "gzip"
</FilesMatch>
